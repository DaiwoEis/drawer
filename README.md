# Unity é«˜æ€§èƒ½ç”»æ¿

åŸºäº Unity æ„å»ºçš„é«˜æ€§èƒ½è·¨å¹³å°ç”»æ¿åº”ç”¨ã€‚é‡‡ç”¨ Mesh Stampingï¼ˆç½‘æ ¼ç›–ç« ï¼‰å’Œ Catmull-Rom æ ·æ¡æ’å€¼æŠ€æœ¯ï¼Œæ—¨åœ¨å¤åˆ» Apple Notes èˆ¬çš„ä¸æ»‘ä¹¦å†™ä½“éªŒã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

*   **é«˜æ€§èƒ½æ¸²æŸ“**: 
    *   **æ··åˆæ¸²æŸ“ç®¡çº¿ (Hybrid Rendering)**: ç»“åˆ CPU å®æ—¶å“åº”ä¸ **Compute Shader** å¹¶è¡Œè®¡ç®—ï¼Œæ”¯æŒå•å¸§ç”Ÿæˆ 10,000+ ç¬”åˆ·å°ç« ï¼Œä»å®¹åº”å¯¹ 4K+ é«˜åˆ†è¾¨ç‡é‡ç»˜ã€‚
    *   **Mesh Stamping**: æ›¿ä»£ Unity åŸç”Ÿ LineRendererï¼Œå®ç°åƒç´ çº§å®Œç¾çš„ç¬”è§¦æ§åˆ¶ã€‚
*   **æ™ºèƒ½æ•°æ®ç®¡ç†**:
    *   **äºŒè¿›åˆ¶å¢é‡å‹ç¼©**: é‡‡ç”¨ VarInt å’Œ ZigZag ç¼–ç çš„è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®ï¼Œå°†ç¬”è¿¹æ•°æ®å‹ç¼©è‡³ **< 5 å­—èŠ‚/ç‚¹**ï¼Œæå¤§é™ä½ç½‘ç»œå¸¦å®½å ç”¨ã€‚
    *   **å››å‰æ ‘ç©ºé—´ç´¢å¼• (QuadTree)**: å®ç°äº†åŸºäºç©ºé—´åˆ’åˆ†çš„é«˜æ•ˆæŸ¥è¯¢ç®—æ³•ï¼Œä¸ºæ“¦é™¤å’Œé€‰åŒºæ“ä½œæä¾›æ¯«ç§’çº§å“åº”ã€‚
*   **ä¸æ»‘æ’å€¼**: å®ç° **Catmull-Rom Spline** ç®—æ³•ï¼Œå°†åŸå§‹è¾“å…¥ç‚¹å¹³æ»‘å¤„ç†ä¸ºè‡ªç„¶çš„æ›²çº¿ï¼Œæ¶ˆé™¤é”¯é½¿æ„Ÿã€‚
*   **æ•´æ´æ¶æ„**: éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) åŸåˆ™ï¼Œä¸¥æ ¼åˆ†ç¦»é¢†åŸŸå±‚ã€åº”ç”¨å±‚ã€è¡¨ç°å±‚å’ŒåŸºç¡€è®¾æ–½å±‚ã€‚
*   **å¯æ‰©å±•ç¬”åˆ·ç³»ç»Ÿ**: åŸºäºç­–ç•¥æ¨¡å¼è®¾è®¡çš„ç¬”åˆ·ç³»ç»Ÿï¼Œæ”¯æŒè½»æ¾åˆ›å»ºæ–°ç¬”åˆ·ï¼ˆå¦‚é“…ç¬”ã€é©¬å…‹ç¬”ã€è½¯ç¬”ã€ç¡¬ç¬”ç­‰ï¼‰ã€‚
*   **æ’¤é”€/é‡åšæ”¯æŒ**: æä¾›å®Œæ•´çš„ç¬”ç”»å†å²è®°å½•ç®¡ç†ä¸çŠ¶æ€æ¢å¤èƒ½åŠ›ã€‚
*   **å“åº”å¼ UI**: è‡ªé€‚åº” UI å¸ƒå±€ï¼Œéšå±å¹•å°ºå¯¸è‡ªåŠ¨ç¼©æ”¾ï¼Œé’ˆå¯¹è§¦æ‘¸å±å’Œé¼ æ ‡æ“ä½œå‡è¿›è¡Œäº†ä¼˜åŒ–ã€‚

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
*   Unity 2021.3 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

### å®‰è£…æ­¥éª¤
1.  åœ¨ Unity ä¸­æ‰“å¼€æœ¬é¡¹ç›®ã€‚
2.  æ‰“å¼€åœºæ™¯æ–‡ä»¶ `Assets/Scenes/SampleScene.unity`ã€‚
3.  å¦‚æœå‘ç° UI ä¸¢å¤±æˆ–æ˜¾ç¤ºå¼‚å¸¸ï¼Œè¯·ä½¿ç”¨é¡¹ç›®è‡ªå¸¦çš„ä¿®å¤å·¥å…·ï¼š
    *   ç‚¹å‡»é¡¶éƒ¨èœå•æ çš„ **Drawing** > **Update UI Only**ã€‚
    *   æ­¤æ“ä½œå°†è‡ªåŠ¨é‡æ–°ç”Ÿæˆå·¥å…·æ ã€é“¾æ¥è„šæœ¬å¼•ç”¨å¹¶é…ç½® Canvas é€‚é…å‚æ•°ã€‚

### é¡¹ç›®ç»“æ„

é¡¹ç›®éµå¾ªåŸºäºåŠŸèƒ½çš„ç›®å½•ç»“æ„è®¾è®¡ï¼š

```text
Assets/Scripts/
â”œâ”€â”€ App/                  # åº”ç”¨å…¥å£ä¸å…¨å±€é…ç½®
â”œâ”€â”€ Common/               # é€šç”¨å·¥å…·ç±»ä¸å¸¸é‡å®šä¹‰
â”œâ”€â”€ Editor/               # ç¼–è¾‘å™¨æ‰©å±•å·¥å…· (å¦‚ SceneSetupTool)
â”œâ”€â”€ Features/
â”‚   â””â”€â”€ Drawing/          # æ ¸å¿ƒç»˜ç”»åŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ App/          # åº”ç”¨å±‚é€»è¾‘ (DrawingAppService)
â”‚       â”œâ”€â”€ Domain/       # é¢†åŸŸå±‚ä¸šåŠ¡é€»è¾‘ä¸å®ä½“
â”‚       â”‚   â”œâ”€â”€ Entity/   # ç¬”ç”»å®ä½“ (StrokeEntity)
â”‚       â”‚   â”œâ”€â”€ ValueObject/ # é€»è¾‘ç‚¹ (LogicPoint)
â”‚       â”‚   â””â”€â”€ BrushStrategy.cs # ç¬”åˆ·ç­–ç•¥é…ç½® (ScriptableObject)
â”‚       â”œâ”€â”€ Presentation/ # è¡¨ç°å±‚ (UI & æ¸²æŸ“å®ç°)
â”‚       â”‚   â”œâ”€â”€ CanvasRenderer.cs # æ ¸å¿ƒæ¸²æŸ“å¼•æ“
â”‚       â”‚   â”œâ”€â”€ MouseInputProvider.cs # è¾“å…¥äº‹ä»¶å¤„ç†
â”‚       â”‚   â””â”€â”€ UI/       # UI äº¤äº’é€»è¾‘ (DrawingToolbar)
â”‚       â””â”€â”€ Service/      # çº¯é€»è¾‘æœåŠ¡ (å¦‚å¹³æ»‘ç®—æ³•)
```

## ğŸ¤– AI åŠ©æ‰‹é›†æˆ (MCP)

æœ¬é¡¹ç›®é›†æˆäº† [Unity MCP](https://github.com/CoplayDev/unity-mcp)ï¼Œå…è®¸ AI åŠ©æ‰‹ç›´æ¥ä¸ Unity ç¼–è¾‘å™¨äº¤äº’ã€‚

*   **è¯¦ç»†æŒ‡å—**: [Docs/MCP_Integration.md](Docs/MCP_Integration.md)
*   **å¿«é€Ÿå¼€å§‹**: æ‰“å¼€ Unity -> Window -> MCP for Unity -> Start Serverã€‚

## ğŸ—ï¸ æ¶æ„ä¸æ ¸å¿ƒæ¨¡å—

### 1. åº”ç”¨å±‚ (`DrawingAppService.cs`)
åº”ç”¨çš„ä¸­æ¢å¤§è„‘ï¼Œè´Ÿè´£åè°ƒè¾“å…¥ã€æ•°æ®å¤„ç†å’Œæ¸²æŸ“æŒ‡ä»¤ã€‚
*   **ä¸»è¦èŒè´£**:
    *   ç®¡ç†å½“å‰å·¥å…·çŠ¶æ€ï¼ˆç¬”åˆ·ç±»å‹ã€é¢œè‰²ã€ç²—ç»†ã€æ©¡çš®æ“¦æ¨¡å¼ï¼‰ã€‚
    *   ç®¡ç†æ’¤é”€/é‡åšå†å²æ ˆ (`StrokeHistoryItem`)ã€‚
    *   æ¥æ”¶æ¥è‡ª `MouseInputProvider` çš„åŸå§‹è¾“å…¥ä¿¡å·ã€‚
    *   è°ƒç”¨ `StrokeSmoothingService` è¿›è¡Œå¹³æ»‘å¤„ç†ã€‚
    *   å‘ `CanvasRenderer` ä¸‹è¾¾ç»˜åˆ¶æŒ‡ä»¤ã€‚

### 2. æ¸²æŸ“å¼•æ“ (`CanvasRenderer.cs`)
å®ç°äº†æ ¸å¿ƒçš„ "Mesh Stamping"ï¼ˆç½‘æ ¼ç›–ç« ï¼‰æŠ€æœ¯ã€‚
*   **å·¥ä½œåŸç†**: æ‘’å¼ƒä¼ ç»Ÿçš„è¿çº¿æ–¹å¼ï¼Œæ”¹ä¸ºåœ¨æ›²çº¿è·¯å¾„çš„æ¯ä¸ªæ’å€¼ç‚¹ä¸Šç»˜åˆ¶ï¼ˆ"ç›–ç« "ï¼‰ä¸€ä¸ªå››è¾¹å½¢ç½‘æ ¼ã€‚
*   **æ€§èƒ½ä¼˜åŒ–**: åˆ©ç”¨ `CommandBuffer` å’Œ `DrawMesh` æ¥å£ç›´æ¥è¿›è¡Œåº•å±‚ GPU ç»˜åˆ¶ï¼Œæ”¯æŒ GPU Instancingã€‚
*   **åŠŸèƒ½ç‰¹æ€§**: æ”¯æŒå‹æ„Ÿï¼ˆåŠ¨æ€é€æ˜åº¦/å¤§å°ï¼‰ã€è‡ªå®šä¹‰ç¬”åˆ·çº¹ç†è´´å›¾ä»¥åŠå¤šç§æ··åˆæ¨¡å¼ï¼ˆå¦‚æ©¡çš®æ“¦ä½¿ç”¨çš„ `ReverseSubtract`ï¼‰ã€‚

### 3. é¢†åŸŸæ¨¡å‹
*   **`LogicPoint`**: è½»é‡çº§ç»“æ„ä½“ï¼Œè¡¨ç¤ºç”»å¸ƒä¸Šçš„ä¸€ä¸ªç‚¹ (x, y, pressure)ã€‚å†…éƒ¨ä½¿ç”¨å½’ä¸€åŒ–åæ ‡ (0-1) æˆ–å®šç‚¹æ•´æ•°å­˜å‚¨ï¼Œç¡®ä¿è·¨ç«¯ä¸€è‡´æ€§ã€‚
*   **`BrushStrategy`**: å®šä¹‰ç¬”åˆ·è¡Œä¸ºçš„ `ScriptableObject` é…ç½®èµ„äº§ã€‚
    *   **å¯é…å±æ€§**: çº¹ç†è´´å›¾ã€åŸºç¡€ä¸é€æ˜åº¦ã€é—´è·æ¯”ä¾‹ (Spacing)ã€è§’åº¦æŠ–åŠ¨ã€æ··åˆæ¨¡å¼ã€‚
    *   **æ‰©å±•æ–¹å¼**: åœ¨ Project è§†å›¾å³é”® -> Create -> Drawing -> BrushStrategy å³å¯åˆ›å»ºæ–°ç¬”åˆ·é…ç½®ã€‚

### 4. è¾“å…¥å¤„ç† (`MouseInputProvider.cs`)
è´Ÿè´£æ•è·é¼ æ ‡æˆ–è§¦æ‘¸è¾“å…¥ï¼Œå¹¶å°†å±å¹•åæ ‡è½¬æ¢ä¸ºç”»æ¿çš„å±€éƒ¨åæ ‡ç³»ã€‚
*   **äº‹ä»¶é©±åŠ¨**: é€šè¿‡ C# äº‹ä»¶è°ƒç”¨ `DrawingAppService` çš„ `StartStroke`, `MoveStroke`, `EndStroke` æ–¹æ³•ã€‚
*   **æ™ºèƒ½é˜²è¯¯è§¦**: å†…ç½® UI é®æŒ¡æ£€æµ‹ï¼Œé˜²æ­¢åœ¨æ“ä½œ UI æŒ‰é’®æˆ–æ»‘å—æ—¶è¯¯è§¦å‘ç»˜ç”»ã€‚

### 5. å¹³æ»‘æœåŠ¡ (`StrokeSmoothingService.cs`)
æ¥æ”¶åŸå§‹çš„è¾“å…¥ç‚¹åºåˆ—ï¼ˆé€šå¸¸å¸¦æœ‰é”¯é½¿æˆ–æŠ–åŠ¨ï¼‰ï¼Œä½¿ç”¨ **Catmull-Rom Splines** ç®—æ³•è¾“å‡ºé«˜å¯†åº¦çš„å¹³æ»‘æ’å€¼ç‚¹ã€‚è¿™ç¡®ä¿äº†å³ä½¿åœ¨å¿«é€Ÿä¹¦å†™æ—¶ï¼Œçº¿æ¡ä¾ç„¶åœ†æ¶¦è‡ªç„¶ã€‚

## ğŸ¨ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç¬”åˆ·
1.  å‡†å¤‡ä¸€å¼ ç¬”åˆ·çº¹ç†å›¾ç‰‡ï¼ˆå»ºè®®ä¸ºå¸¦ Alpha é€šé“çš„ PNGï¼Œç™½è‰²èƒŒæ™¯é€æ˜ï¼‰ã€‚
2.  åœ¨ Unity Project çª—å£ä¸­ï¼šå³é”® -> **Create** -> **Drawing** -> **BrushStrategy**ã€‚
3.  å°†çº¹ç†å›¾ç‰‡èµ‹å€¼ç»™é…ç½®æ–‡ä»¶çš„ `Main Texture` å­—æ®µã€‚
4.  è°ƒæ•´å‚æ•°ï¼š
    *   **Spacing Ratio**: å†³å®šç›–ç« çš„å¯†åº¦ã€‚å€¼è¶Šä½çº¿æ¡è¶Šè¿ç»­å¹³æ»‘ï¼Œå€¼è¶Šé«˜åˆ™å½¢æˆè™šçº¿æ•ˆæœã€‚
    *   **Procedural SDF**: å‹¾é€‰ `Use Procedural SDF` å¯å¯ç”¨å®Œç¾åœ†å½¢æ¨¡å¼ï¼ˆå¿½ç•¥è´´å›¾ï¼‰ï¼Œå¹¶é€šè¿‡ `Edge Softness` è°ƒæ•´è¾¹ç¼˜æŸ”å’Œåº¦ã€‚
    *   **Blend Mode**: æ™®é€šç¬”åˆ·é€šå¸¸ä½¿ç”¨ Standardï¼Œç‰¹æ®Šå åŠ æ•ˆæœå¯é€‰æ‹©å…¶ä»–æ¨¡å¼ã€‚
5.  å°†æ–°åˆ›å»ºçš„ç­–ç•¥æ–‡ä»¶åˆ†é…ç»™ UIï¼ˆé€šè¿‡ä¿®æ”¹ `DrawingToolbar` è„šæœ¬æˆ–åœ¨ Inspector ä¸­æ‰‹åŠ¨æŒ‡å®šï¼‰ã€‚

### ä¿®æ”¹ UI å¸ƒå±€
*   æœ¬é¡¹ç›®çš„ UI ç»“æ„ç”± `SceneSetupTool.cs` è„šæœ¬è‡ªåŠ¨ç”Ÿæˆï¼Œä»¥ç¡®ä¿ç»„ä»¶é“¾æ¥çš„ç¨³å®šæ€§ã€‚
*   **è°ƒæ•´å°ºå¯¸/ä½ç½®**: ç›´æ¥ä¿®æ”¹ `SceneSetupTool.cs` é¡¶éƒ¨çš„å¸¸é‡å®šä¹‰ï¼ˆå¦‚ `NAV_HEIGHT`, `ICON_SIZE`ï¼‰ï¼Œä¿å­˜åè¿è¡Œèœå• **Drawing** > **Update UI Only** å³å¯ç”Ÿæ•ˆã€‚
*   **æ·»åŠ æ–°æŒ‰é’®**: éœ€è¦ä¿®æ”¹ `DrawingToolbar.cs` é€»è¾‘ä»¥åŠå¯¹åº”çš„ Prefab ç”Ÿæˆä»£ç ã€‚

### å®šåˆ¶æ¸²æŸ“æ•ˆæœ
*   **Shaders**: æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ä½äº `Assets/Scripts/Features/Drawing/Presentation/Shaders/BrushStamp.shader`ã€‚ä¿®æ”¹æ­¤ Shader å¯ä»¥æ”¹å˜ç¬”è§¦çš„ç€è‰²æ–¹å¼æˆ–æ··åˆç®—æ³•ã€‚
*   **ç”»å¸ƒåˆ†è¾¨ç‡**: å¯åœ¨ `CanvasRenderer` ç»„ä»¶çš„ Inspector é¢æ¿ä¸­é…ç½®ï¼ˆé»˜è®¤é€»è¾‘ä¼šè‡ªåŠ¨åŒ¹é…å±å¹•çºµæ¨ªæ¯”ï¼‰ã€‚

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

*   **GameObjects ä¸Šæ˜¾ç¤º "Script Missing"**:
    *   è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨è„šæœ¬è¢«ç§»åŠ¨ä½ç½®æˆ–é‡å‘½ååã€‚åªéœ€è¿è¡Œé¡¶éƒ¨èœå• **Drawing** > **Update UI Only**ï¼Œå·¥å…·ä¼šè‡ªåŠ¨é‡æ–°æŸ¥æ‰¾å¹¶é“¾æ¥ä¸¢å¤±çš„å¼•ç”¨ã€‚
*   **ç¬”è§¦çœ‹èµ·æ¥æ¨¡ç³Š**:
    *   è¯·ç¡®ä¿ Canvas Scaler ç»„ä»¶çš„ UI Scale Mode è®¾ç½®ä¸º "Scale With Screen Size"ã€‚ä½¿ç”¨ `Update UI Only` å·¥å…·ä¼šè‡ªåŠ¨ä¿®æ­£æ­¤è®¾ç½®ã€‚
*   **UI å…ƒç´ å¤ªå°/å¤ªå¤§**:
    *   è¿™æ˜¯å› ä¸ºä¸åŒå±å¹• DPI å¯¼è‡´çš„ã€‚è¯·è°ƒæ•´ `SceneSetupTool.cs` ä¸­çš„å°ºå¯¸å¸¸é‡ï¼Œç„¶åé‡æ–°ç”Ÿæˆ UIã€‚

## ğŸ”— å‚è€ƒä»£ç 
*   [DrawingAppService.cs](Assets/Scripts/Features/Drawing/App/DrawingAppService.cs)
*   [CanvasRenderer.cs](Assets/Scripts/Features/Drawing/Presentation/CanvasRenderer.cs)
*   [SceneSetupTool.cs](Assets/Scripts/Editor/SceneSetupTool.cs)
